---
import DropDown from "@components/DropDown.astro";
import SideNav from "@components/SideNav.astro";
import TopNav from "@components/TopNav.astro";
import Layout from "@layouts/Layout.astro";
import { SEO } from "astro-seo";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";

const rawEvents = await getCollection("events");

const events = rawEvents.sort(
  (e1, e2) => e1.data.date.getTime() - e2.data.date.getTime()
);
---

<Layout title="Welcome to Astro.">
  <SEO slot="head" title="Le Bouillon des Eaux Vives | Programmation" />

  <TopNav>Programmation</TopNav>

  <SideNav showIndexLink showPresentationLink showMenuLink showDayMenuLink />

  <main h-full text-gray-800 grow p-8 overflow-y-auto bg-background-gray>
    <div max-w-150 m-x-auto flex="~ col" gap-8 md:gap-12>
      <h1 hidden md:block text="8 md:center" uppercase font-display font-normal>
        Programmation
      </h1>

      {
        events.map(async (event) => {
          const { Content } = await event.render();

          return (
            <article shadow-xl rounded-xl flex="~ col" overflow-hidden>
              <div relative>
                <Image
                  src={event.data.image}
                  alt="Football"
                  class="w-full h-50 object-cover shrink-0"
                />

                <h2
                  text="6 white center"
                  font-display
                  absolute
                  right-0
                  bottom-0
                  left-0
                  bg-gray-800
                  bg-op-50
                  p-y-2
                >
                  {event.data.title}
                </h2>

                <time
                  datetime="2024-04-18"
                  bg-primary
                  text-white
                  absolute
                  top-0
                  right-0
                  p="x-2 y-1"
                  flex="~ col"
                  items-center
                >
                  <div text-7 leading-7>
                    {event.data.date.getDate()}
                  </div>

                  <div>
                    {new Intl.DateTimeFormat("en-US", {
                      month: "short",
                    }).format(event.data.date)}
                  </div>
                </time>
              </div>

              <div flex="~ col" gap-4 p="4 md:8">
                <p>{event.data.summary}</p>

                <DropDown summary="En savoir plus">
                  <div class="markdown">
                    <Content />
                  </div>
                </DropDown>
              </div>
            </article>
          );
        })
      }

      {
        events.length === 0 && (
          <p flex items-center gap-2 justify-center mt-16>
            <i i-carbon-calendar block w-6 h-6 />
            Pas encore d'évennement prévu
          </p>
        )
      }
    </div>
  </main>

  <SideNav showContactLink />
</Layout>

<style>
  .markdown :global(p) {
    margin-top: 1rem;
  }
</style>
